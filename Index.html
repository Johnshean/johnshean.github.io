<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roti Bakar POS - Cloud Edition</title>
    <style>
        :root { --primary: #d2691e; --dark: #5d4037; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2, h3 { color: var(--dark); border-bottom: 2px solid var(--primary); padding-bottom: 8px; margin-top: 0; }
        
        .menu-grid { display: grid; gap: 10px; margin-bottom: 20px; }
        .btn-menu { background: #fff8f0; border: 1px solid var(--primary); padding: 12px; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; font-size: 1rem; }
        .btn-menu:hover { background: var(--primary); color: white; }
        
        .pembayaran { background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }

        .struk-preview { background: #fff; border: 1px dashed #999; padding: 15px; font-family: monospace; min-height: 200px; font-size: 0.9rem; }
        .report-box { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-top: 20px; grid-column: span 2; }
        .report-grid { display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; gap: 10px; }
        
        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-print { background: #27ae60; color: white; }
        .btn-clear-data { background: #95a5a6; color: white; margin-top: 20px; font-size: 0.8rem; padding: 5px; }

        @media print {
            body * { visibility: hidden; }
            #area-cetak, #area-cetak * { visibility: visible; }
            #area-cetak { position: absolute; left: 0; top: 0; width: 100%; border: none; }
        }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } .report-box { grid-column: span 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>üçû Menu Roti Bakar</h2>
        <div class="pembayaran">
            <strong>Topping:</strong><br>
            <label><input type="checkbox" class="topping" value="3000" data-name="Keju"> Keju (+3k)</label>
            <label style="margin-left:10px;"><input type="checkbox" class="topping" value="2000" data-name="Susu"> Susu (+2k)</label>
        </div>
        
        <div class="menu-grid">
            <button class="btn-menu" onclick="tambahItem('Roti Cokelat', 15000)"><span>Roti Cokelat</span> <b>15k</b></button>
            <button class="btn-menu" onclick="tambahItem('Roti Keju', 17000)"><span>Roti Keju</span> <b>17k</b></button>
            <button class="btn-menu" onclick="tambahItem('Roti Spesial', 25000)"><span>Roti Spesial</span> <b>25k</b></button>
        </div>

        <div class="pembayaran">
            <label>Metode Pembayaran:</label>
            <select id="metode" onchange="hitungSemua()">
                <option value="Tunai">Tunai</option>
                <option value="QRIS">QRIS</option>
            </select>
            <div id="box-tunai">
                <label>Uang Tunai Diterima:</label>
                <input type="number" id="uang-bayar" placeholder="0" oninput="hitungSemua()">
            </div>
        </div>
        <button class="btn-action" style="background:#eee" onclick="resetKeranjang()">Hapus Pesanan</button>
    </div>

    <div class="card">
        <h2>üßæ Struk Preview</h2>
        <div id="area-cetak" class="struk-preview">
            <div style="text-align:center; text-transform: uppercase;">
                <strong>Roti Bakar Jaya</strong><br>
                <small id="waktu-struk">-</small>
            </div>
            <hr>
            <div id="item-list"></div>
            <hr>
            <div style="text-align:right">
                TOTAL: <strong id="total-text">Rp 0</strong><br>
                <span id="detail-pembayaran-struk">
                    Metode: <span id="metode-text">Tunai</span><br>
                    Bayar: <span id="bayar-text">0</span><br>
                    Kembali: <strong id="kembali-text">0</strong>
                </span>
            </div>
        </div>
        <button class="btn-action btn-print" onclick="simpanDanCetak()">Selesaikan & Cetak Struk</button>
    </div>

    <div class="report-box">
        <h3>üìä Laporan Penjualan (Tersimpan di Perangkat)</h3>
        <div class="report-grid">
            <div><small>Total Omzet</small><div id="rep-omzet" style="font-size: 1.2em; font-weight: bold;">Rp 0</div></div>
            <div><small>Porsi Terjual</small><div id="rep-items" style="font-size: 1.2em; font-weight: bold;">0</div></div>
            <div><small>Tunai / QRIS</small><div id="rep-split" style="font-size: 0.9em;">0 / 0</div></div>
        </div>
        <button class="btn-clear-data" onclick="hapusSemuaData()">Reset Laporan Hari Ini</button>
    </div>
</div>

<script>
    let keranjang = [];
    let totalHarga = 0;
    
    // Memuat data dari LocalStorage saat halaman dibuka
    let laporan = JSON.parse(localStorage.getItem('laporanRoti')) || { omzet: 0, tunai: 0, qris: 0, porsi: 0 };

    window.onload = updateLaporanUI;

    function tambahItem(nama, harga) {
        let hargaFinal = harga;
        let topping = [];
        document.querySelectorAll('.topping:checked').forEach(t => {
            hargaFinal += parseInt(t.value);
            topping.push(t.getAttribute('data-name'));
        });

        keranjang.push({ nama: nama + (topping.length > 0 ? " +" + topping.join(",") : ""), harga: hargaFinal });
        updateKeranjangUI();
    }

    function updateKeranjangUI() {
        const list = document.getElementById('item-list');
        list.innerHTML = '';
        totalHarga = 0;
        keranjang.forEach(item => {
            list.innerHTML += `<div style="display:flex; justify-content:space-between"><span>${item.nama}</span><span>${item.harga.toLocaleString()}</span></div>`;
            totalHarga += item.harga;
        });
        document.getElementById('total-text').textContent = "Rp " + totalHarga.toLocaleString();
        document.getElementById('waktu-struk').textContent = new Date().toLocaleString('id-ID');
        hitungSemua();
    }

    function hitungSemua() {
        const metode = document.getElementById('metode').value;
        const uangBayar = parseInt(document.getElementById('uang-bayar').value) || 0;
        document.getElementById('metode-text').textContent = metode;
        
        if(metode === "QRIS") {
            document.getElementById('box-tunai').style.display = 'none';
            document.getElementById('bayar-text').textContent = totalHarga.toLocaleString();
            document.getElementById('kembali-text').textContent = "0";
        } else {
            document.getElementById('box-tunai').style.display = 'block';
            document.getElementById('bayar-text').textContent = uangBayar.toLocaleString();
            let kembali = uangBayar - totalHarga;
            document.getElementById('kembali-text').textContent = (kembali > 0 ? kembali : 0).toLocaleString();
        }
    }

    function simpanDanCetak() {
        if(keranjang.length === 0) return alert("Keranjang masih kosong!");
        
        const metode = document.getElementById('metode').value;
        laporan.omzet += totalHarga;
        laporan.porsi += keranjang.length;
        if(metode === "Tunai") laporan.tunai += totalHarga;
        else laporan.qris += totalHarga;

        // Simpan ke LocalStorage
        localStorage.setItem('laporanRoti', JSON.stringify(laporan));
        
        updateLaporanUI();
        window.print();
        resetKeranjang();
    }

    function updateLaporanUI() {
        document.getElementById('rep-omzet').textContent = "Rp " + laporan.omzet.toLocaleString();
        document.getElementById('rep-items').textContent = laporan.porsi + " Porsi";
        document.getElementById('rep-split').textContent = `T: ${laporan.tunai.toLocaleString()} | Q: ${laporan.qris.toLocaleString()}`;
    }

    function resetKeranjang() {
        keranjang = [];
        document.getElementById('uang-bayar').value = '';
        updateKeranjangUI();
    }

    function hapusSemuaData() {
        if(confirm("Hapus semua catatan penjualan?")) {
            localStorage.removeItem('laporanRoti');
            location.reload();
        }
    }
</script>
</body>
</html>
